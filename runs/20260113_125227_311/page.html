<html>
<head>
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; img-src data: https: blob:; style-src 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com; font-src https://fonts.gstatic.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; script-src 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://unpkg.com https://d3js.org https://cdn.plot.ly https://cdn.tailwindcss.com; connect-src 'self' http://localhost:* http://127.0.0.1:* https://*.tile.openstreetmap.org; base-uri 'none'; form-action 'none';">
    <title>Employee Evaluation App</title>
    <link href="https://cdn.tailwindcss.com" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5/papaparse.min.js"></script>
</head>
<style>
    body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 0;
    }
    .nav-bar {
        background-color: #007a8a;
        color: #fff;
        padding: 1rem;
        text-align: center;
    }
    .nav-bar ul {
        list-style: none;
        margin: 0;
        padding: 0;
    }
    .nav-bar li {
        display: inline-block;
        margin-right: 20px;
    }
    .nav-bar a {
        color: #fff;
        text-decoration: none;
    }
    .dashboard {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        padding: 2rem;
    }
    .data-table {
        padding: 2rem;
    }
    .chart-component {
        padding: 2rem;
    }
    .report-component {
        padding: 2rem;
    }
    .file-upload-component {
        padding: 2rem;
    }
    .high-contrast-mode {
        background-color: #000;
        color: #fff;
    }
</style>
<body>
    <nav class="nav-bar">
        <ul>
            <li><a href="#home">Home</a></li>
            <li><a href="#dashboard">Dashboard</a></li>
            <li><a href="#data-table">Data Table</a></li>
            <li><a href="#chart">Chart</a></li>
            <li><a href="#report">Report</a></li>
        </ul>
    </nav>
    <div id="home" class="file-upload-component">
        <h1>Upload CSV file</h1>
        <input type="file" id="csv-file" accept=".csv">
        <button id="upload-button">Upload</button>
        <progress id="upload-progress" value="0" max="100"></progress>
    </div>
    <div id="dashboard" class="dashboard">
        <h1>Dashboard</h1>
        <div>
            <h2>Total Hours Worked</h2>
            <p id="total-hours-worked"></p>
        </div>
        <div>
            <h2>Average Hours Worked per Day</h2>
            <p id="average-hours-worked-per-day"></p>
        </div>
    </div>
    <div id="data-table" class="data-table">
        <h1>Data Table</h1>
        <table id="data-table-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Employee ID</th>
                    <th>Date</th>
                    <th>Clock-in Time</th>
                    <th>Clock-out Time</th>
                </tr>
            </thead>
            <tbody id="data-table-body"></tbody>
        </table>
    </div>
    <div id="chart" class="chart-component">
        <h1>Chart</h1>
        <canvas id="chart-canvas"></canvas>
    </div>
    <div id="report" class="report-component">
        <h1>Report</h1>
        <p id="report-text"></p>
    </div>
    <button id="high-contrast-mode-button">Toggle High Contrast Mode</button>
    <script>
        const csvFileInput = document.getElementById('csv-file');
        const uploadButton = document.getElementById('upload-button');
        const uploadProgress = document.getElementById('upload-progress');
        const totalHoursWorkedElement = document.getElementById('total-hours-worked');
        const averageHoursWorkedPerDayElement = document.getElementById('average-hours-worked-per-day');
        const dataTableRow = document.getElementById('data-table-body');
        const chartCanvas = document.getElementById('chart-canvas');
        const reportText = document.getElementById('report-text');
        const highContrastModeButton = document.getElementById('high-contrast-mode-button');
        let csvData = [];
        let calculatedMetrics = {};
        let highContrastMode = false;
        uploadButton.addEventListener('click', () => {
            const csvFile = csvFileInput.files[0];
            Papa.parse(csvFile, {
                header: true,
                complete: (results) => {
                    csvData = results.data;
                    calculateMetrics();
                    displayDashboard();
                    displayDataTable();
                    displayChart();
                    displayReport();
                }
            });
        });
        function calculateMetrics() {
            calculatedMetrics = {};
            csvData.forEach((row) => {
                const employeeId = row['Employee ID'];
                if (!calculatedMetrics[employeeId]) {
                    calculatedMetrics[employeeId] = {
                        totalHoursWorked: 0,
                        averageHoursWorkedPerDay: 0
                    };
                }
                const clockInTime = new Date(row['Clock-in Time']);
                const clockOutTime = new Date(row['Clock-out Time']);
                const hoursWorked = (clockOutTime - clockInTime) / 3600000;
                calculatedMetrics[employeeId].totalHoursWorked += hoursWorked;
            });
            Object.keys(calculatedMetrics).forEach((employeeId) => {
                const totalHoursWorked = calculatedMetrics[employeeId].totalHoursWorked;
                const averageHoursWorkedPerDay = totalHoursWorked / csvData.length;
                calculatedMetrics[employeeId].averageHoursWorkedPerDay = averageHoursWorkedPerDay;
            });
        }
        function displayDashboard() {
            const totalHoursWorked = Object.values(calculatedMetrics).reduce((acc, curr) => acc + curr.totalHoursWorked, 0);
            const averageHoursWorkedPerDay = Object.values(calculatedMetrics).reduce((acc, curr) => acc + curr.averageHoursWorkedPerDay, 0) / Object.keys(calculatedMetrics).length;
            totalHoursWorkedElement.textContent = `Total Hours Worked: ${totalHoursWorked}`;
            averageHoursWorkedPerDayElement.textContent = `Average Hours Worked per Day: ${averageHoursWorkedPerDay}`;
        }
        function displayDataTable() {
            dataTableRow.innerHTML = '';
            csvData.forEach((row) => {
                const rowElement = document.createElement('tr');
                rowElement.innerHTML = `
                    <td>${row['Name']}</td>
                    <td>${row['Employee ID']}</td>
                    <td>${row['Date']}</td>
                    <td>${row['Clock-in Time']}</td>
                    <td>${row['Clock-out Time']}</td>
                `;
                dataTableRow.appendChild(rowElement);
            });
        }
        function displayChart() {
            const chartData = Object.values(calculatedMetrics).map((metrics) => metrics.totalHoursWorked);
            const chartLabels = Object.keys(calculatedMetrics);
            new Chart(chartCanvas, {
                type: 'bar',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        label: 'Total Hours Worked',
                        data: chartData,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        function displayReport() {
            reportText.textContent = '';
            Object.keys(calculatedMetrics).forEach((employeeId) => {
                const metrics = calculatedMetrics[employeeId];
                reportText.textContent += `Employee ID: ${employeeId}\nTotal Hours Worked: ${metrics.totalHoursWorked}\nAverage Hours Worked per Day: ${metrics.averageHoursWorkedPerDay}\n\n`;
            });
        }
        highContrastModeButton.addEventListener('click', () => {
            highContrastMode = !highContrastMode;
            if (highContrastMode) {
                document.body.classList.add('high-contrast-mode');
            } else {
                document.body.classList.remove('high-contrast-mode');
            }
        });
    </script>

<script id="gea-runtime-helper">
(function () {
  if (window.geaRuntimeLLM) return;
  const defaultModel = "llama-3.3-70b-versatile";
  async function callRuntimeLLM(prompt, options = {}) {
    if (!prompt || typeof prompt !== "string") {
      throw new Error("Prompt must be a non-empty string");
    }
    const model = typeof options.model === 'string' && options.model.trim() ? options.model.trim() : defaultModel;
    const response = await fetch('/api/runtime/llm', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt, model }),
      signal: options.signal
    });
    if (!response.ok) {
      const error = await response.json().catch(() => ({}));
      throw new Error(error && error.error ? error.error : 'Runtime LLM request failed');
    }
    const data = await response.json().catch(() => ({}));
    return data && data.response ? data.response : '';
  }
  window.geaRuntimeLLM = callRuntimeLLM;
})();
</script>
</body>
</html>