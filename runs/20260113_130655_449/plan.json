{
  "title": "Timesheet Performance Analyzer – Fixed Loading State",
  "description": "A client‑side GE Appliances internal tool that lets users upload a CSV timesheet, computes punctuality against a 9 am‑5 pm schedule, identifies the best and worst performers, and provides on‑demand explanations. The app no longer shows a persistent loading overlay; the spinner appears only while the file is being parsed and processed and hides automatically when the work completes or fails.",
  "pages": [
    {
      "name": "Home",
      "purpose": "Upload CSV, view best/worst performer cards, deviation bar chart, and employee metrics table."
    },
    {
      "name": "Settings",
      "purpose": "Toggle dark/light mode, clear stored data, and adjust upload preferences."
    }
  ],
  "ui_components": [
    "Drag‑and‑drop upload zone with hidden file input fallback",
    "Header with app title, dark‑mode toggle, and reset button",
    "Card for Best Performer summary",
    "Card for Worst Performer summary",
    "Chart.js bar chart showing total deviation per employee",
    "Simple‑DataTables sortable/searchable employee metrics table",
    "Modal dialog for explanation (opened only via \"Why?\" buttons)",
    "Toast notifications (SweetAlert2) for upload success, errors, and processing status",
    "Loading overlay with spinner that auto‑hides after processing",
    "Footer with version and year"
  ],
  "libraries": [
    "Tailwind CSS for styling and responsive layout",
    "DaisyUI for component styling",
    "Lucide icons for UI icons",
    "Alpine.js for reactivity and modal handling",
    "Chart.js for bar‑chart visualization",
    "PapaParse for client‑side CSV parsing",
    "Simple‑DataTables for interactive tables",
    "SweetAlert2 for toast and alert dialogs",
    "window.geaRuntimeLLM(prompt) for AI‑generated explanations"
  ],
  "state": [
    "uploadedFile: File object representing the selected CSV",
    "rawRows: array of parsed CSV rows (employee_id, name, date, clock_in, clock_out)",
    "employees: array of { employee_id, name, avgLateMins, avgEarlyMins, totalDeviation }",
    "bestEmployee: object with the lowest totalDeviation",
    "worstEmployee: object with the highest totalDeviation",
    "theme: 'light' | 'dark' persisted in localStorage",
    "showExplanationModal: boolean (default false) controlling modal visibility",
    "modalEmployee: object of the employee whose explanation is shown",
    "modalType: string ('best' | 'worst') for modal heading",
    "explanationText: string generated by LLM or fallback template",
    "loading: boolean indicating parsing/processing state (true only during file handling)",
    "chartInstance: Chart.js instance",
    "dataTableInstance: Simple‑DataTables instance"
  ],
  "interactions": [
    "User drags a CSV onto the upload zone or clicks it to open the file picker; the hidden input receives the file.",
    "On file selection, validate the file extension; if invalid, show a SweetAlert2 error toast and keep loading=false.",
    "When a valid CSV is chosen, set loading=true, parse with PapaParse (header:true, skipEmptyLines:true). In the PapaParse complete callback, process rows, compute metrics, update state, render chart and table, then set loading=false inside a finally block so the spinner always hides.",
    "For each row, compute lateMins = max(0, minutes between clock_in and 09:00) and earlyMins = max(0, minutes between 17:00 and clock_out).",
    "Aggregate per employee: average late minutes, average early‑leave minutes, totalDeviation = avgLateMins + avgEarlyMins (rounded to two decimals).",
    "Identify bestEmployee (minimum totalDeviation) and worstEmployee (maximum totalDeviation).",
    "Persist employees, bestEmployee, worstEmployee, and theme in localStorage; on page load, restore them and keep loading=false.",
    "Render Best and Worst cards with metrics and a \"Why?\" button.",
    "Clicking a \"Why?\" button sets modalEmployee, modalType, calls window.geaRuntimeLLM with a prompt containing that employee’s metrics, stores the result in explanationText (fallback to templated text on failure), and sets showExplanationModal=true.",
    "Modal can be closed via the X button, clicking outside, or pressing Escape; closing resets modal state.",
    "Chart.js bar chart displays totalDeviation for each employee; best performer bar is green, worst performer bar is red. The chart is refreshed only after processing completes.",
    "Simple‑DataTables provides column sorting, pagination, and a search box for the employee table; row clicks do not trigger the modal.",
    "Dark‑mode toggle updates the Tailwind dark class, stores the preference, and updates all UI components.",
    "Reset button clears all stored data (employees, theme) from localStorage and reloads the page to the initial state."
  ],
  "acceptance_criteria": [
    "Upload zone accepts CSV via drag‑and‑drop or click‑to‑browse; hidden file input is correctly triggered.",
    "Non‑CSV files produce a clear error toast and do not crash the app.",
    "When a valid CSV is selected, a spinner appears only during parsing and processing and disappears automatically after the work finishes, regardless of success or error.",
    "CSV parsing completes without errors; employee metrics table populates correctly.",
    "Average lateness and early‑leave are calculated in minutes with two‑decimal precision.",
    "Best Performer card shows the employee with the smallest total deviation; Worst Performer card shows the largest.",
    "Explanation modal is hidden on page load and only appears after the user clicks a \"Why?\" button.",
    "Modal displays a concise natural‑language explanation generated by the LLM or a fallback template.",
    "Bar chart shows a bar for each employee; best performer bar is green, worst performer bar is red.",
    "Employee table columns are sortable, searchable, and paginated; clicking rows does not open the modal.",
    "Dark‑mode toggle works, persists across reloads, and updates all UI components.",
    "All computed data and theme preference are saved in localStorage; refreshing the page restores the previous analysis without showing any modal or spinner.",
    "No external network requests are made except for loading permitted CDN libraries; all CSV processing runs client‑side.",
    "UI complies with GE Appliances accessibility standards: keyboard‑navigable, ARIA labels on interactive elements, sufficient color contrast."
  ]
}