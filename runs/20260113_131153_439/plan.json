{
  "title": "Timesheet Performance Analyzer – Secure Vanilla Edition",
  "description": "A pure client‑side internal tool for GE Appliances that lets users upload a CSV timesheet, calculates punctuality against a 9 am‑5 pm schedule, identifies the best and worst performers, and shows a concise explanation. All code, styles, and assets are bundled in the page; no external resources, no localStorage, and no pop‑ups on load.",
  "pages": [
    {
      "name": "Home",
      "purpose": "Upload CSV, display best/worst performer cards, render an SVG bar chart of total deviation, and show a sortable, filterable employee metrics table."
    }
  ],
  "ui_components": [
    "Drag‑and‑drop upload zone with hidden file input fallback",
    "Header with app title and dark‑mode toggle button (in‑memory only)",
    "Card for Best Performer summary",
    "Card for Worst Performer summary",
    "SVG bar chart visualizing total deviation per employee (green for best, red for worst)",
    "HTML table for employee metrics with sortable columns and a name filter input",
    "Modal dialog for explanation (opened only via \"Why?\" buttons)",
    "Toast‑style notification area for success/error messages",
    "Loading overlay with CSS spinner displayed only while parsing/processing",
    "Footer with version and year"
  ],
  "libraries": [
    "None – all functionality built with native HTML, CSS, and JavaScript"
  ],
  "state": [
    "rawRows: array of parsed CSV rows (employee_id, name, date, clock_in, clock_out)",
    "employees: array of { employee_id, name, avgLateMins, avgEarlyMins, totalDeviation }",
    "bestEmployee: object with the lowest totalDeviation",
    "worstEmployee: object with the highest totalDeviation",
    "theme: 'light' | 'dark' (default light, stored only in memory)",
    "showExplanationModal: boolean (default false) controlling modal visibility",
    "modalEmployee: object of the employee whose explanation is shown",
    "modalType: string ('best' | 'worst') for modal heading",
    "explanationText: string generated by LLM or fallback template",
    "loading: boolean indicating parsing/processing state",
    "sortState: { column: string, direction: 'asc' | 'desc' } for table sorting",
    "filterText: string entered in the name filter input"
  ],
  "interactions": [
    "User drags a CSV onto the upload zone or clicks it to open the file picker; the hidden input receives the file.",
    "On file selection, validate the .csv extension; if invalid, show an error toast and abort processing.",
    "When a valid CSV is chosen, set loading=true, display the loading overlay, read the file with FileReader, split lines, parse CSV manually (ignore header row), and push rows into rawRows.",
    "For each row, compute lateMins = max(0, minutes between clock_in and 09:00) and earlyMins = max(0, minutes between 17:00 and clock_out).",
    "Aggregate per employee: average late minutes, average early‑leave minutes, totalDeviation = avgLateMins + avgEarlyMins (rounded to two decimals).",
    "Identify bestEmployee (minimum totalDeviation) and worstEmployee (maximum totalDeviation).",
    "Render the Best and Worst cards with employee name, total deviation, and a \"Why?\" button; cards remain hidden until data is ready.",
    "Clicking a \"Why?\" button sets modalEmployee and modalType, calls window.geaRuntimeLLM with a prompt containing that employee’s metrics, stores the result in explanationText (fallback to a templated sentence on failure), then sets showExplanationModal=true to display the modal.",
    "Modal can be closed via the X button, clicking outside the modal, or pressing Escape; closing resets modal state.",
    "Generate an SVG bar chart: create a <svg> element, draw a rectangle for each employee proportional to totalDeviation, color the best performer’s bar green, the worst performer’s bar red, and label each bar with employee name and deviation value.",
    "Table column headers are clickable; clicking toggles sort direction and re‑renders the tbody according to sortState.",
    "The filter input updates filterText on input events; the table rows are re‑rendered to show only employees whose name includes the filter text (case‑insensitive).",
    "Dark‑mode toggle switches a CSS class on <html>, updates CSS custom properties for colors, and updates the UI immediately; the setting is not persisted across reloads to avoid localStorage.",
    "Loading overlay is shown only while the file is being read and processed; it is hidden in a finally block after processing completes or fails.",
    "Toast notifications appear for a few seconds then fade out; they are used for success, error, and informational messages."
  ],
  "acceptance_criteria": [
    "Upload zone accepts CSV via drag‑and‑drop or click‑to‑browse; hidden file input works correctly.",
    "Selecting a non‑CSV file shows a clear error toast and does not crash the app.",
    "When a valid CSV is selected, a spinner overlay appears only during parsing and disappears automatically after processing finishes.",
    "CSV parsing completes without errors; the employee metrics table populates with two‑decimal minute values for average lateness, average early‑leave, and total deviation.",
    "Best Performer card displays the employee with the smallest total deviation; Worst Performer card displays the employee with the largest total deviation.",
    "Explanation modal is hidden on page load and appears only after the user clicks a \"Why?\" button; it shows a concise natural‑language explanation generated by the LLM or a fallback template.",
    "SVG bar chart shows a bar for each employee; the best performer’s bar is green, the worst performer’s bar is red, and all bars are correctly scaled and labeled.",
    "Employee table columns are sortable by clicking headers; sorting toggles between ascending and descending and updates the displayed rows.",
    "The filter input dynamically filters the table rows by employee name, case‑insensitively.",
    "Dark‑mode toggle changes the visual theme instantly and works without errors; the preference is not persisted across page reloads.",
    "No modal or toast appears automatically on page load; the UI starts with only the header, upload zone, filter input (disabled until data exists), and footer visible.",
    "All code, styles, and assets are bundled in the page; no external network requests are made, satisfying the security policy.",
    "The app runs correctly in a sandboxed environment without requiring the 'allow‑same‑origin' flag (i.e., no use of localStorage, sessionStorage, or cookies).",
    "All interactive elements are keyboard‑accessible, have appropriate ARIA attributes, and meet color‑contrast requirements for accessibility."
  ]
}